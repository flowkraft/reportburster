services:
  code-server:
    container_name: code-server
    build:
      context: .
      dockerfile: Dockerfile.code-server
    # Configure git, then start code-server
    command: >-
      bash -c "git config --global user.name 'flowkraft' &&
               git config --global user.email 'virgil.trasca@gmail.com' &&
               code-server --bind-addr 0.0.0.0:8080 --auth none"
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
    volumes:
      # All 6 project directories
      - ${PROJECTS_FOLDER_PATH}/all-repos/src/company-biz/flowkraft/www:/project-company-biz-www
      - ${PROJECTS_FOLDER_PATH}/all-repos/src/products/reportburster:/project-rb
      - ${PROJECTS_FOLDER_PATH}/all-repos/src/company-biz/flowkraft/enterprise:/project-company-biz-new
      - ${PROJECTS_FOLDER_PATH}/all-repos/devops-gitops:/project-devops-gitops
      - ${PROJECTS_FOLDER_PATH}/all-repos/src/virgil:/project-virgil
      - ${PROJECTS_FOLDER_PATH}/all-repos/src/company-biz:/project-company-biz-all
      - ${PROJECTS_FOLDER_PATH}/all-repos:/all-repos
      - ${PROJECTS_FOLDER_PATH}/all-repos/src/virgil/plaintext/biz/agents-headquarter:/agents-hq
      
      # Workspace files with color configurations
      - ./workspaces:/workspaces

      # Claude authentication persistence (survives docker compose down -v)
      - /var/kraft-internalsystems/apps/cvs/shelf-code-server/config/.claude:/root/.claude
    restart: unless-stopped
    networks:
      - bridge_current_host_cross_containers_net

networks:
  bridge_current_host_cross_containers_net:
    driver: bridge
    external: true
