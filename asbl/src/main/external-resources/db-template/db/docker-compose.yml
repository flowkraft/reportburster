services:
  postgres:
    image: postgres:16.2
    container_name: rb-northwind-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    ports:
      - "${POSTGRES_PORT}:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

  mysql:
    image: mysql:8.3.0
    container_name: rb-northwind-mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DB}
      MYSQL_ROOT_HOST: '%'
    ports:
      - "${MYSQL_PORT}:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    command: --general-log=1 --general-log-file=/var/log/mysql/mysql-general.log
    restart: unless-stopped

  mariadb:
    image: mariadb:11.3.2
    container_name: rb-northwind-mariadb
    environment:
      MARIADB_ROOT_PASSWORD: ${MARIADB_PASSWORD}
      MARIADB_DATABASE: ${MARIADB_DB}
      MARIADB_ROOT_HOST: '%'
    ports:
      - "${MARIADB_PORT}:3306"  # set MARIADB_PORT (e.g. 3307) if you need to avoid conflicts
    volumes:
      - mariadb_data:/var/lib/mysql
    command: --general-log=1 --general-log-file=/var/log/mysql/mariadb-general.log
    restart: unless-stopped

  sqlserver:
    image: mcr.microsoft.com/mssql/server:2019-latest
    container_name: rb-northwind-sqlserver
    environment:
      ACCEPT_EULA: Y
      MSSQL_SA_PASSWORD: ${SQLSERVER_PASSWORD}
      MSSQL_PID: Developer
    ports:
      - "${SQLSERVER_PORT}:1433"
    volumes:
      - sqlserver_data:/var/opt/mssql
    restart: unless-stopped

  oracle:
    image: gvenzl/oracle-xe:21-slim-faststart
    container_name: rb-northwind-oracle
    environment:
      ORACLE_PASSWORD: ${ORACLE_PASSWORD:-oracle}
      APP_USER: ${ORACLE_USER:-oracle}
      APP_USER_PASSWORD: ${ORACLE_PASSWORD:-oracle}
      ORACLE_CHARACTERSET: AL32UTF8
    ports:
      - "${ORACLE_PORT:-1521}:1521"
    volumes:
      - oracle_data:/opt/oracle/oradata
    restart: unless-stopped
    command: --databaseConfigurationType=SMALL
    healthcheck:
      test: ["CMD", "healthcheck.sh"]
      interval: 10s
      timeout: 5s
      retries: 10

  db2:
    image: icr.io/db2_community/db2:11.5.9.0
    container_name: rb-northwind-db2
    privileged: true
    environment:
      LICENSE: accept
      DB2INST1_PASSWORD: ${DB2_PASSWORD}
      DBNAME: ${DB2_DB}
      PERSISTENT_HOME: "false"
      ARCHIVE_LOGS: "false"
      BLU: "false"
    ports:
      - "${DB2_PORT}:50000"
    volumes:
      - db2_data:/database
    healthcheck:
      test: ["CMD-SHELL", "su - db2inst1 -c 'db2 connect to ${DB2_DB} >/dev/null 2>&1 && db2 terminate'"]
      interval: 30s
      timeout: 10s
      retries: 30
    restart: unless-stopped

volumes:
  postgres_data:
  mysql_data:
  mariadb_data:
  sqlserver_data:
  oracle_data:
  db2_data: